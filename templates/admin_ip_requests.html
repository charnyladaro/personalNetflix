{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>IP Access Requests</h1>
    
    <div class="admin-controls" style="margin-bottom: 30px;">
        <a href="{{ url_for('admin') }}" class="btn btn-secondary">Back to Admin Panel</a>
        <a href="{{ url_for('ip_whitelist') }}" class="btn btn-secondary" style="margin-left: 10px;">IP Whitelist</a>
        <a href="{{ url_for('admin_logs') }}" class="btn btn-secondary" style="margin-left: 10px;">Access Logs</a>
    </div>

    <!-- Pending Requests -->
    <h2>Pending Requests ({{ pending_requests|length }})</h2>
    {% if pending_requests %}
    <table class="admin-table">
        <thead>
            <tr>
                <th>IP Address</th>
                <th>Name</th>
                <th>Reason</th>
                <th>Request Time</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for request in pending_requests %}
            <tr style="background-color: #fff3cd20;">
                <td><strong>{{ request[1] }}</strong></td>
                <td>{{ request[2] or 'Anonymous' }}</td>
                <td>{{ request[3] or 'No reason provided' }}</td>
                <td>{{ request[4][:19] if request[4] else 'N/A' }}</td>
                <td>
                    <a href="{{ url_for('approve_ip_request', request_id=request[0]) }}" 
                       class="btn" 
                       onclick="return confirm('Approve access for IP {{ request[1] }}?')"
                       style="margin-right: 5px; padding: 5px 10px; background-color: #4CAF50;">
                       ✓ Approve
                    </a>
                    <a href="{{ url_for('reject_ip_request', request_id=request[0]) }}" 
                       class="btn" 
                       onclick="return confirm('Reject access request for IP {{ request[1] }}?')"
                       style="background-color: #d32f2f; padding: 5px 10px;">
                       ✗ Reject
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="background-color: #4CAF5020; padding: 20px; border-radius: 8px; text-align: center;">
        <p style="color: #4CAF50; margin: 0;">✓ No pending IP access requests</p>
    </div>
    {% endif %}

    <!-- Request History -->
    <h2 style="margin-top: 40px;">Request History</h2>
    {% if all_requests %}
    <table class="admin-table">
        <thead>
            <tr>
                <th>IP Address</th>
                <th>Name</th>
                <th>Reason</th>
                <th>Request Time</th>
                <th>Status</th>
                <th>Processed By</th>
                <th>Processed Time</th>
            </tr>
        </thead>
        <tbody>
            {% for request in all_requests %}
            <tr {% if request[5] == 'pending' %}style="background-color: #fff3cd20;"
                {% elif request[5] == 'approved' %}style="background-color: #4CAF5020;"
                {% else %}style="background-color: #f4433620;"{% endif %}>
                <td><strong>{{ request[1] }}</strong></td>
                <td>{{ request[2] or 'Anonymous' }}</td>
                <td>{{ request[3] or 'No reason provided' }}</td>
                <td>{{ request[4][:19] if request[4] else 'N/A' }}</td>
                <td>
                    {% if request[5] == 'pending' %}
                    <span style="color: #ff9800;">⏳ Pending</span>
                    {% elif request[5] == 'approved' %}
                    <span style="color: #4CAF50;">✓ Approved</span>
                    {% else %}
                    <span style="color: #f44336;">✗ Rejected</span>
                    {% endif %}
                </td>
                <td>{{ request[7] or 'N/A' }}</td>
                <td>{{ request[6][:19] if request[6] else 'N/A' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No IP access requests found.</p>
    {% endif %}
</div>

<style>
.admin-table tr[style*="fff3cd20"] {
    border-left: 4px solid #ff9800;
}

.admin-table tr[style*="4CAF5020"] {
    border-left: 4px solid #4CAF50;
}

.admin-table tr[style*="f4433620"] {
    border-left: 4px solid #f44336;
}

.btn:hover {
    transform: translateY(-1px);
    transition: all 0.2s ease;
}
</style>
{% endblock %}